<script lang="ts">
	import { goto } from '$app/navigation';
	import { onMount } from 'svelte';
	import { blur } from 'svelte/transition';
	import type { PageData } from './$types';
	import { enhance, type SubmitFunction } from '$app/forms';
	import { supabaseClient } from '$lib/supabase';
	import { Menu, X } from 'lucide-svelte';

	let current = 0;
	let menuVisible = false;

	onMount(async () => {
		const user = await supabaseClient.auth.getSession();
		if (user.data.session) {
			goto('/app');
		}
		rotateText();
	});

	function rotateText() {
		setInterval(() => {
			current = (current + 1) % 5;
		}, 5000);
	}

	function gotoApp() {
		goto('/app');
	}

	function gotoDemo() {
		goto('/demo');
	}

	function gotoLogin() {
		goto('/login');
	}

	function gotoRegister() {
		goto('/register');
	}

	const submitLogout: SubmitFunction = async ({ cancel }) => {
		const { error } = await supabaseClient.auth.signOut();
		if (error) {
			console.log(error);
		}
		cancel();
	};

	function toggleMenu() {
		menuVisible = !menuVisible;
	}

	export let data: PageData;
</script>

<nav class="fixed top-0 h-20 w-screen bg-opacity-50 backdrop-blur-sm">
	<div class="mx-auto flex h-full max-w-5xl items-center justify-between px-4 xl:px-0">
		<a href="/" class="text-gray-1000 dark:text-gray-50">
			<svg
				width="176"
				height="38"
				viewBox="0 0 176 38"
				fill="none"
				xmlns="http://www.w3.org/2000/svg"
			>
				<path
					class="hidden md:block"
					d="M48.6243 35.1364V26.3793H48.4858C48.2727 26.8338 47.9709 27.2848 47.5803 27.7322C47.1967 28.1726 46.696 28.5384 46.0781 28.8295C45.4673 29.1207 44.7216 29.2663 43.8409 29.2663C42.598 29.2663 41.4723 28.9467 40.4638 28.3075C39.4624 27.6612 38.6669 26.7131 38.0774 25.4631C37.495 24.206 37.2038 22.6648 37.2038 20.8395C37.2038 18.9645 37.5057 17.4055 38.1094 16.1626C38.7131 14.9126 39.5156 13.9787 40.517 13.3608C41.5256 12.7358 42.63 12.4233 43.8303 12.4233C44.7464 12.4233 45.5099 12.5795 46.1207 12.892C46.7386 13.1974 47.2358 13.581 47.6122 14.0426C47.9957 14.4972 48.2869 14.9446 48.4858 15.3849H48.6776V12.6364H53.152V35.1364H48.6243ZM45.2791 25.6548C46.0107 25.6548 46.6286 25.456 47.1328 25.0582C47.6442 24.6534 48.0348 24.0888 48.3047 23.3643C48.5817 22.6399 48.7202 21.7912 48.7202 20.8182C48.7202 19.8452 48.5852 19 48.3153 18.2827C48.0455 17.5653 47.6548 17.0114 47.1435 16.6207C46.6321 16.2301 46.0107 16.0348 45.2791 16.0348C44.5334 16.0348 43.9048 16.2372 43.3935 16.642C42.8821 17.0469 42.495 17.608 42.2322 18.3253C41.9695 19.0426 41.8381 19.8736 41.8381 20.8182C41.8381 21.7699 41.9695 22.6115 42.2322 23.343C42.5021 24.0675 42.8892 24.6357 43.3935 25.0476C43.9048 25.4524 44.5334 25.6548 45.2791 25.6548ZM67.2891 22.0327V12.6364H71.8274V29H67.4702V26.0277H67.2997C66.9304 26.9865 66.3161 27.7571 65.4567 28.3395C64.6044 28.9219 63.5639 29.2131 62.3352 29.2131C61.2415 29.2131 60.2791 28.9645 59.4482 28.4673C58.6172 27.9702 57.9673 27.2635 57.4986 26.3473C57.0369 25.4311 56.8026 24.3338 56.7955 23.0554V12.6364H61.3338V22.2457C61.3409 23.2116 61.6001 23.9751 62.1115 24.5362C62.6229 25.0973 63.3082 25.3778 64.1676 25.3778C64.7145 25.3778 65.2259 25.2536 65.7017 25.005C66.1776 24.7493 66.5611 24.3729 66.8523 23.8757C67.1506 23.3786 67.2962 22.7642 67.2891 22.0327ZM82.851 29.3196C81.1962 29.3196 79.7651 28.968 78.5577 28.2649C77.3574 27.5547 76.4306 26.5675 75.7772 25.3033C75.1238 24.032 74.7971 22.5582 74.7971 20.8821C74.7971 19.1918 75.1238 17.7145 75.7772 16.4503C76.4306 15.179 77.3574 14.1918 78.5577 13.4886C79.7651 12.7784 81.1962 12.4233 82.851 12.4233C84.5059 12.4233 85.9334 12.7784 87.1337 13.4886C88.3411 14.1918 89.2715 15.179 89.9249 16.4503C90.5783 17.7145 90.905 19.1918 90.905 20.8821C90.905 22.5582 90.5783 24.032 89.9249 25.3033C89.2715 26.5675 88.3411 27.5547 87.1337 28.2649C85.9334 28.968 84.5059 29.3196 82.851 29.3196ZM82.8723 25.804C83.6252 25.804 84.2537 25.5909 84.758 25.1648C85.2623 24.7315 85.6422 24.142 85.8979 23.3963C86.1607 22.6506 86.2921 21.8018 86.2921 20.8501C86.2921 19.8984 86.1607 19.0497 85.8979 18.304C85.6422 17.5582 85.2623 16.9687 84.758 16.5355C84.2537 16.1023 83.6252 15.8857 82.8723 15.8857C82.1124 15.8857 81.4732 16.1023 80.9547 16.5355C80.4434 16.9687 80.0563 17.5582 79.7935 18.304C79.5378 19.0497 79.41 19.8984 79.41 20.8501C79.41 21.8018 79.5378 22.6506 79.7935 23.3963C80.0563 24.142 80.4434 24.7315 80.9547 25.1648C81.4732 25.5909 82.1124 25.804 82.8723 25.804ZM102.56 12.6364V16.0455H92.7054V12.6364H102.56ZM94.9426 8.71591H99.481V23.9716C99.481 24.3906 99.5449 24.7173 99.6728 24.9517C99.8006 25.179 99.9782 25.3388 100.205 25.4311C100.44 25.5234 100.71 25.5696 101.015 25.5696C101.228 25.5696 101.441 25.5518 101.654 25.5163C101.867 25.4737 102.031 25.4418 102.144 25.4205L102.858 28.7976C102.631 28.8686 102.311 28.9503 101.899 29.0426C101.487 29.142 100.987 29.2024 100.397 29.2237C99.3034 29.2663 98.3446 29.1207 97.5208 28.7869C96.704 28.4531 96.0684 27.9347 95.6138 27.2315C95.1593 26.5284 94.9355 25.6406 94.9426 24.5682V8.71591ZM112.798 29.3196C111.115 29.3196 109.666 28.9787 108.451 28.2969C107.244 27.608 106.313 26.6349 105.66 25.3778C105.007 24.1136 104.68 22.6186 104.68 20.8928C104.68 19.2095 105.007 17.7322 105.66 16.4609C106.313 15.1896 107.233 14.1989 108.419 13.4886C109.612 12.7784 111.012 12.4233 112.617 12.4233C113.696 12.4233 114.701 12.5973 115.632 12.9453C116.569 13.2862 117.386 13.8011 118.082 14.4901C118.785 15.179 119.332 16.0455 119.722 17.0895C120.113 18.1264 120.308 19.3409 120.308 20.733V21.9794H106.491V19.1669H116.036C116.036 18.5135 115.894 17.9347 115.61 17.4304C115.326 16.9261 114.932 16.532 114.428 16.2479C113.931 15.9567 113.352 15.8111 112.691 15.8111C112.002 15.8111 111.392 15.9709 110.859 16.2905C110.333 16.603 109.921 17.0256 109.623 17.5582C109.325 18.0838 109.172 18.6697 109.165 19.3161V21.9901C109.165 22.7997 109.314 23.4993 109.612 24.0888C109.918 24.6783 110.347 25.1328 110.901 25.4524C111.455 25.772 112.112 25.9318 112.872 25.9318C113.377 25.9318 113.838 25.8608 114.257 25.7188C114.676 25.5767 115.035 25.3636 115.333 25.0795C115.632 24.7955 115.859 24.4474 116.015 24.0355L120.213 24.3125C119.999 25.321 119.563 26.2017 118.902 26.9545C118.249 27.7003 117.404 28.2827 116.367 28.7017C115.337 29.1136 114.147 29.3196 112.798 29.3196ZM123.355 29V7.18182H127.894V15.3849H128.032C128.231 14.9446 128.519 14.4972 128.895 14.0426C129.279 13.581 129.776 13.1974 130.387 12.892C131.004 12.5795 131.771 12.4233 132.688 12.4233C133.881 12.4233 134.982 12.7358 135.99 13.3608C136.999 13.9787 137.805 14.9126 138.409 16.1626C139.012 17.4055 139.314 18.9645 139.314 20.8395C139.314 22.6648 139.019 24.206 138.43 25.4631C137.847 26.7131 137.052 27.6612 136.044 28.3075C135.042 28.9467 133.92 29.2663 132.677 29.2663C131.796 29.2663 131.047 29.1207 130.429 28.8295C129.818 28.5384 129.318 28.1726 128.927 27.7322C128.536 27.2848 128.238 26.8338 128.032 26.3793H127.83V29H123.355ZM127.798 20.8182C127.798 21.7912 127.933 22.6399 128.203 23.3643C128.472 24.0888 128.863 24.6534 129.374 25.0582C129.886 25.456 130.507 25.6548 131.239 25.6548C131.977 25.6548 132.602 25.4524 133.114 25.0476C133.625 24.6357 134.012 24.0675 134.275 23.343C134.545 22.6115 134.68 21.7699 134.68 20.8182C134.68 19.8736 134.548 19.0426 134.286 18.3253C134.023 17.608 133.636 17.0469 133.124 16.642C132.613 16.2372 131.985 16.0348 131.239 16.0348C130.5 16.0348 129.875 16.2301 129.364 16.6207C128.86 17.0114 128.472 17.5653 128.203 18.2827C127.933 19 127.798 19.8452 127.798 20.8182ZM149.736 29.3196C148.081 29.3196 146.65 28.968 145.442 28.2649C144.242 27.5547 143.315 26.5675 142.662 25.3033C142.009 24.032 141.682 22.5582 141.682 20.8821C141.682 19.1918 142.009 17.7145 142.662 16.4503C143.315 15.179 144.242 14.1918 145.442 13.4886C146.65 12.7784 148.081 12.4233 149.736 12.4233C151.391 12.4233 152.818 12.7784 154.018 13.4886C155.226 14.1918 156.156 15.179 156.81 16.4503C157.463 17.7145 157.79 19.1918 157.79 20.8821C157.79 22.5582 157.463 24.032 156.81 25.3033C156.156 26.5675 155.226 27.5547 154.018 28.2649C152.818 28.968 151.391 29.3196 149.736 29.3196ZM149.757 25.804C150.51 25.804 151.138 25.5909 151.643 25.1648C152.147 24.7315 152.527 24.142 152.783 23.3963C153.045 22.6506 153.177 21.8018 153.177 20.8501C153.177 19.8984 153.045 19.0497 152.783 18.304C152.527 17.5582 152.147 16.9687 151.643 16.5355C151.138 16.1023 150.51 15.8857 149.757 15.8857C148.997 15.8857 148.358 16.1023 147.839 16.5355C147.328 16.9687 146.941 17.5582 146.678 18.304C146.423 19.0497 146.295 19.8984 146.295 20.8501C146.295 21.8018 146.423 22.6506 146.678 23.3963C146.941 24.142 147.328 24.7315 147.839 25.1648C148.358 25.5909 148.997 25.804 149.757 25.804ZM163.947 12.6364L166.952 18.3572L170.031 12.6364H174.686L169.945 20.8182L174.814 29H170.18L166.952 23.343L163.777 29H159.089L163.947 20.8182L159.26 12.6364H163.947Z"
					fill="black"
				/>
				<rect x="56.75" y="8" width="15" height="3" fill="black" class="hidden md:block" />
				<path
					d="M31.5 26V14C31.4995 13.4739 31.3606 12.9572 31.0973 12.5017C30.834 12.0462 30.4556 11.668 30 11.405L19.5 5.40498C19.0439 5.14167 18.5266 5.00305 18 5.00305C17.4734 5.00305 16.9561 5.14167 16.5 5.40498L6 11.405C5.54439 11.668 5.16597 12.0462 4.90269 12.5017C4.63941 12.9572 4.50054 13.4739 4.5 14V26C4.50054 26.5261 4.63941 27.0428 4.90269 27.4982C5.16597 27.9537 5.54439 28.3319 6 28.595L8.625 30.095L6.75 36.095L13.875 33.095L16.5 34.595C16.9561 34.8583 17.4734 34.9969 18 34.9969C18.5266 34.9969 19.0439 34.8583 19.5 34.595L30 28.595C30.4556 28.3319 30.834 27.9537 31.0973 27.4982C31.3606 27.0428 31.4995 26.5261 31.5 26Z"
					stroke="black"
					stroke-width="3"
					stroke-linecap="round"
					stroke-linejoin="round"
				/>
				<path
					d="M4.935 12.5L18 20L31.065 12.5"
					stroke="black"
					stroke-width="3"
					stroke-linecap="round"
					stroke-linejoin="round"
				/>
				<path
					d="M18 35V20"
					stroke="black"
					stroke-width="3"
					stroke-linecap="round"
					stroke-linejoin="round"
				/>
			</svg>
		</a>
		<div class="hidden text-gray-1000 dark:text-gray-50 md:flex">
			<button>Features</button>
			<button>Test</button>
		</div>
		<div class="hidden md:flex">
			<button
				on:click={gotoLogin}
				class="rounded-full py-2 px-4 font-bold text-gray-1000 dark:text-gray-50">Login</button
			>
			<button
				on:click={gotoRegister}
				class="rounded-full border border-gray-1000 bg-gray-1000 py-2 px-4 font-bold text-gray-100 dark:border-gray-50 dark:bg-gray-50 dark:text-gray-1000"
				>Register</button
			>
		</div>
		<div class="flex md:hidden">
			<button on:click={toggleMenu} class="text-gray-1000 dark:text-gray-50">
				{#if menuVisible}
					<X />
				{:else}
					<Menu />
				{/if}
			</button>
		</div>
	</div>
</nav>

<main class="mx-auto mt-20 grid max-w-5xl px-4 pt-8 md:pt-32 xl:px-0">
	{#if menuVisible}
		<div class="flex flex-col items-center justify-center">
			<button
				on:click={gotoLogin}
				class="mb-4 rounded-full py-2 px-4 font-bold text-gray-1000 dark:text-gray-50"
			>
				Login
			</button>
			<button
				on:click={gotoRegister}
				class="rounded-full border border-gray-1000 bg-gray-1000 py-2 px-4 font-bold text-gray-100 dark:border-gray-50 dark:bg-gray-50 dark:text-gray-1000"
			>
				Register
			</button>
		</div>
	{:else if data.session}
		{#if data.session.user}
			<h1 class="md:text-7x dark:text-gray-50l text-4xl font-bold text-gray-1000">
				Welcome back, <span class="text-svelte-orange">{data.session.user.email}</span>!
			</h1>
			<form action="/logout" method="POST" use:enhance={submitLogout}>
				<button
					type="submit"
					class="btn btn-primary mt-6 w-full rounded-full border border-transparent bg-gray-1000 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-gray-800 focus:outline-none focus:ring-1 focus:ring-svelte-orange focus:ring-offset-2"
					>Logout</button
				>
			</form>
		{/if}
	{:else}
		<h1 class="text-4xl font-bold text-gray-1000 dark:text-gray-50 md:text-7xl">
			Never forget a meaningful moment and save the best quotes from your
			{#if current === 0}
				<span class="text-svelte-orange" in:blur={{ duration: 250 }}>friends</span>.
			{:else if current === 1}
				<span class="text-svelte-orange" in:blur={{ duration: 250 }}>children</span>.
			{:else if current === 2}
				<span class="text-svelte-orange" in:blur={{ duration: 250 }}>siblings</span>.
			{:else if current === 3}
				<span class="text-svelte-orange" in:blur={{ duration: 250 }}>partner</span>.
			{:else if current === 4}
				<span class="text-svelte-orange" in:blur={{ duration: 250 }}>parents</span>.
			{/if}
		</h1>

		<div class="mt-8 flex gap-2 md:mt-16">
			<button
				on:click={gotoRegister}
				class="rounded-full border border-gray-1000 bg-gray-1000 py-2 px-4 font-bold text-gray-100 dark:border-gray-50 dark:bg-gray-50 dark:text-gray-1000"
				>Create account</button
			>

			<button
				on:click={gotoApp}
				class="rounded-full border border-gray-1000 py-2 px-4 font-bold text-gray-1000 dark:border-gray-50 dark:text-gray-50"
				>Demo</button
			>
		</div>
	{/if}
</main>
